!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],i):i(t.jQuery)}(this,function(t){"use strict";function i(t){return"number"==typeof t&&!R(t)}function e(t){return void 0===t}function a(t,i){for(var e=arguments.length,a=Array(e>2?e-2:0),n=2;n<e;n++)a[n-2]=arguments[n];return function(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];return t.apply(i,a.concat(n))}}function n(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return P.test(t)?Math.round(t*i)/i:t}function o(t){var i=t.match(U);return i&&(i[1]!==I.protocol||i[2]!==I.hostname||i[3]!==I.port)}function h(t){var i="timestamp="+(new Date).getTime();return t+(-1===t.indexOf("?")?"?":"&")+i}function s(t){var e=t.rotate,a=t.scaleX,n=t.scaleY,o=t.translateX,h=t.translateY,s=[];return i(o)&&0!==o&&s.push("translateX("+o+"px)"),i(h)&&0!==h&&s.push("translateY("+h+"px)"),i(e)&&0!==e&&s.push("rotate("+e+"deg)"),i(a)&&1!==a&&s.push("scaleX("+a+")"),i(n)&&1!==n&&s.push("scaleY("+n+")"),s.length?s.join(" "):"none"}function r(i,e){var a=i.pageX,n=i.pageY,o={endX:a,endY:n};return e?o:t.extend({startX:a,startY:n},o)}function d(t){var i=t.aspectRatio,e=t.height,a=t.width,n=function(t){return j(t)&&t>0};return n(a)&&n(e)?e*i>a?e=a/i:a=e*i:n(a)?e=a/i:n(e)&&(a=e*i),{width:a,height:e}}function l(t){var i=new DataView(t),e=void 0,a=void 0,n=void 0,o=void 0;if(255===i.getUint8(0)&&216===i.getUint8(1))for(var h=i.byteLength,s=2;s<h;){if(255===i.getUint8(s)&&225===i.getUint8(s+1)){n=s;break}s+=1}if(n){var r=n+10;if("Exif"===function(t,i,e){var a="",n=void 0;for(e+=i,n=i;n<e;n+=1)a+=S(t.getUint8(n));return a}(i,n+4,4)){var d=i.getUint16(r);if(((a=18761===d)||19789===d)&&42===i.getUint16(r+2,a)){var l=i.getUint32(r+4,a);l>=8&&(o=r+l)}}}if(o){var c=i.getUint16(o,a),p=void 0,m=void 0;for(m=0;m<c;m+=1)if(p=o+12*m+2,274===i.getUint16(p,a)){p+=8,e=i.getUint16(p,a),i.setUint16(p,1,a);break}}return e}t=t&&t.hasOwnProperty("default")?t.default:t;var c="undefined"!=typeof window?window:{},p="cropper",m=p+"-crop",g=p+"-disabled",u=p+"-hidden",f=p+"-hide",v=p+"-modal",w=p+"-move",x="action",b="preview",y="crop",C="cropend",M="cropmove",$="cropstart",B=c.PointerEvent?"pointerdown":"touchstart mousedown",k=c.PointerEvent?"pointermove":"touchmove mousemove",W=c.PointerEvent?"pointerup pointercancel":"touchend touchcancel mouseup",D="wheel mousewheel DOMMouseScroll",T=/^(e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/,H=/^data:/,Y=/^data:image\/jpeg;base64,/,X=/^(img|canvas)$/i,z={viewMode:0,dragMode:"crop",aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},O=function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")},E=function(){function t(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(i,e,a){return e&&t(i.prototype,e),a&&t(i,a),i}}(),N=function(t){if(Array.isArray(t)){for(var i=0,e=Array(t.length);i<t.length;i++)e[i]=t[i];return e}return Array.from(t)},R=Number.isNaN||c.isNaN,L=Object.keys||function(i){var e=[];return t.each(i,function(t){e.push(t)}),e},P=/\.\d*(?:0|9){12}\d*$/i,I=c.location,U=/^(https?:)\/\/([^:\/?#]+):?(\d*)/i,A=c.navigator,F=A&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(A.userAgent),j=Number.isFinite||c.isFinite,S=String.fromCharCode,q=/^data:.*,/,Q={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var t=this.$element,i=this.options,e=this.$container,a=this.$cropper;a.addClass(u),t.removeClass(u),a.css(this.container={width:Math.max(e.width(),Number(i.minContainerWidth)||200),height:Math.max(e.height(),Number(i.minContainerHeight)||100)}),t.addClass(u),a.removeClass(u)},initCanvas:function(){var i=this.container,e=this.image,a=this.options.viewMode,n=Math.abs(e.rotate)%180==90,o=n?e.naturalHeight:e.naturalWidth,h=n?e.naturalWidth:e.naturalHeight,s=o/h,r=i.width,d=i.height;i.height*s>i.width?3===a?r=i.height*s:d=i.width/s:3===a?d=i.width/s:r=i.height*s;var l={aspectRatio:s,naturalWidth:o,naturalHeight:h,width:r,height:d};l.left=(i.width-r)/2,l.top=(i.height-d)/2,l.oldLeft=l.left,l.oldTop=l.top,this.canvas=l,this.limited=1===a||2===a,this.limitCanvas(!0,!0),this.initialImage=t.extend({},e),this.initialCanvas=t.extend({},l)},limitCanvas:function(t,i){var e=this.options,a=this.container,n=this.canvas,o=this.cropBox,h=e.viewMode,s=n.aspectRatio,r=this.cropped&&o;if(t){var l=Number(e.minCanvasWidth)||0,c=Number(e.minCanvasHeight)||0;h>0&&(h>1?(l=Math.max(l,a.width),c=Math.max(c,a.height),3===h&&(c*s>l?l=c*s:c=l/s)):l?l=Math.max(l,r?o.width:0):c?c=Math.max(c,r?o.height:0):r&&(l=o.width,(c=o.height)*s>l?l=c*s:c=l/s));var p=d({aspectRatio:s,width:l,height:c});l=p.width,c=p.height,n.minWidth=l,n.minHeight=c,n.maxWidth=1/0,n.maxHeight=1/0}if(i)if(h>0){var m=a.width-n.width,g=a.height-n.height;n.minLeft=Math.min(0,m),n.minTop=Math.min(0,g),n.maxLeft=Math.max(0,m),n.maxTop=Math.max(0,g),r&&this.limited&&(n.minLeft=Math.min(o.left,o.left+o.width-n.width),n.minTop=Math.min(o.top,o.top+o.height-n.height),n.maxLeft=o.left,n.maxTop=o.top,2===h&&(n.width>=a.width&&(n.minLeft=Math.min(0,m),n.maxLeft=Math.max(0,m)),n.height>=a.height&&(n.minTop=Math.min(0,g),n.maxTop=Math.max(0,g))))}else n.minLeft=-n.width,n.minTop=-n.height,n.maxLeft=a.width,n.maxTop=a.height},renderCanvas:function(t,i){var e=this.canvas,a=this.image;if(i){var n=function(t){var i=t.width,e=t.height,a=t.degree;if(90==(a=Math.abs(a)%180))return{width:e,height:i};var n=a%90*Math.PI/180,o=Math.sin(n),h=Math.cos(n),s=i*h+e*o,r=i*o+e*h;return a>90?{width:r,height:s}:{width:s,height:r}}({width:a.naturalWidth*Math.abs(a.scaleX||1),height:a.naturalHeight*Math.abs(a.scaleY||1),degree:a.rotate||0}),o=n.width,h=n.height,r=e.width*(o/e.naturalWidth),d=e.height*(h/e.naturalHeight);e.left-=(r-e.width)/2,e.top-=(d-e.height)/2,e.width=r,e.height=d,e.aspectRatio=o/h,e.naturalWidth=o,e.naturalHeight=h,this.limitCanvas(!0,!1)}(e.width>e.maxWidth||e.width<e.minWidth)&&(e.left=e.oldLeft),(e.height>e.maxHeight||e.height<e.minHeight)&&(e.top=e.oldTop),e.width=Math.min(Math.max(e.width,e.minWidth),e.maxWidth),e.height=Math.min(Math.max(e.height,e.minHeight),e.maxHeight),this.limitCanvas(!1,!0),e.left=Math.min(Math.max(e.left,e.minLeft),e.maxLeft),e.top=Math.min(Math.max(e.top,e.minTop),e.maxTop),e.oldLeft=e.left,e.oldTop=e.top,this.$canvas.css({width:e.width,height:e.height,transform:s({translateX:e.left,translateY:e.top})}),this.renderImage(t),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(i){var e=this.canvas,a=this.image,n=a.naturalWidth*(e.width/e.naturalWidth),o=a.naturalHeight*(e.height/e.naturalHeight);t.extend(a,{width:n,height:o,left:(e.width-n)/2,top:(e.height-o)/2}),this.$clone.css({width:a.width,height:a.height,transform:s(t.extend({translateX:a.left,translateY:a.top},a))}),i&&this.output()},initCropBox:function(){var i=this.options,e=this.canvas,a=i.aspectRatio,n=Number(i.autoCropArea)||.8,o={width:e.width,height:e.height};a&&(e.height*a>e.width?o.height=o.width/a:o.width=o.height*a),this.cropBox=o,this.limitCropBox(!0,!0),o.width=Math.min(Math.max(o.width,o.minWidth),o.maxWidth),o.height=Math.min(Math.max(o.height,o.minHeight),o.maxHeight),o.width=Math.max(o.minWidth,o.width*n),o.height=Math.max(o.minHeight,o.height*n),o.left=e.left+(e.width-o.width)/2,o.top=e.top+(e.height-o.height)/2,o.oldLeft=o.left,o.oldTop=o.top,this.initialCropBox=t.extend({},o)},limitCropBox:function(t,i){var e=this.options,a=this.container,n=this.canvas,o=this.cropBox,h=this.limited,s=e.aspectRatio;if(t){var r=Number(e.minCropBoxWidth)||0,d=Number(e.minCropBoxHeight)||0,l=Math.min(a.width,h?n.width:a.width),c=Math.min(a.height,h?n.height:a.height);r=Math.min(r,a.width),d=Math.min(d,a.height),s&&(r&&d?d*s>r?d=r/s:r=d*s:r?d=r/s:d&&(r=d*s),c*s>l?c=l/s:l=c*s),o.minWidth=Math.min(r,l),o.minHeight=Math.min(d,c),o.maxWidth=l,o.maxHeight=c}i&&(h?(o.minLeft=Math.max(0,n.left),o.minTop=Math.max(0,n.top),o.maxLeft=Math.min(a.width,n.left+n.width)-o.width,o.maxTop=Math.min(a.height,n.top+n.height)-o.height):(o.minLeft=0,o.minTop=0,o.maxLeft=a.width-o.width,o.maxTop=a.height-o.height))},renderCropBox:function(){var t=this.options,i=this.container,e=this.cropBox;(e.width>e.maxWidth||e.width<e.minWidth)&&(e.left=e.oldLeft),(e.height>e.maxHeight||e.height<e.minHeight)&&(e.top=e.oldTop),e.width=Math.min(Math.max(e.width,e.minWidth),e.maxWidth),e.height=Math.min(Math.max(e.height,e.minHeight),e.maxHeight),this.limitCropBox(!1,!0),e.left=Math.min(Math.max(e.left,e.minLeft),e.maxLeft),e.top=Math.min(Math.max(e.top,e.minTop),e.maxTop),e.oldLeft=e.left,e.oldTop=e.top,t.movable&&t.cropBoxMovable&&this.$face.data(x,e.width>=i.width&&e.height>=i.height?"move":"all"),this.$cropBox.css({width:e.width,height:e.height,transform:s({translateX:e.left,translateY:e.top})}),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),this.completed&&this.trigger(y,this.getData())}},K={initPreview:function(){var i=this.crossOrigin,e=i?this.crossOriginUrl:this.url,a=document.createElement("img");i&&(a.crossOrigin=i),a.src=e;var n=t(a);this.$preview=t(this.options.preview),this.$clone2=n,this.$viewBox.html(n),this.$preview.each(function(a,n){var o=t(n),h=document.createElement("img");o.data(b,{width:o.width(),height:o.height(),html:o.html()}),i&&(h.crossOrigin=i),h.src=e,h.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',o.html(h)})},resetPreview:function(){this.$preview.each(function(i,e){var a=t(e),n=a.data(b);a.css({width:n.width,height:n.height}).html(n.html).removeData(b)})},preview:function(){var i=this.image,e=this.canvas,a=this.cropBox,n=a.width,o=a.height,h=i.width,r=i.height,d=a.left-e.left-i.left,l=a.top-e.top-i.top;this.cropped&&!this.disabled&&(this.$clone2.css({width:h,height:r,transform:s(t.extend({translateX:-d,translateY:-l},i))}),this.$preview.each(function(e,a){var c=t(a),p=c.data(b),m=p.width,g=p.height,u=m,f=g,v=1;n&&(f=o*(v=m/n)),o&&f>g&&(u=n*(v=g/o),f=g),c.css({width:u,height:f}).find("img").css({width:h*v,height:r*v,transform:s(t.extend({translateX:-d*v,translateY:-l*v},i))})}))}},Z={bind:function(){var i=this.$element,e=this.options,n=this.$cropper;t.isFunction(e.cropstart)&&i.on($,e.cropstart),t.isFunction(e.cropmove)&&i.on(M,e.cropmove),t.isFunction(e.cropend)&&i.on(C,e.cropend),t.isFunction(e.crop)&&i.on(y,e.crop),t.isFunction(e.zoom)&&i.on("zoom",e.zoom),n.on(B,a(this.cropStart,this)),e.zoomable&&e.zoomOnWheel&&n.on(D,a(this.wheel,this)),e.toggleDragModeOnDblclick&&n.on("dblclick",a(this.dblclick,this)),t(this.element.ownerDocument).on(k,this.onCropMove=a(this.cropMove,this)).on(W,this.onCropEnd=a(this.cropEnd,this)),e.responsive&&t(window).on("resize",this.onResize=a(this.resize,this))},unbind:function(){var i=this.$element,e=this.options,a=this.$cropper;t.isFunction(e.cropstart)&&i.off($,e.cropstart),t.isFunction(e.cropmove)&&i.off(M,e.cropmove),t.isFunction(e.cropend)&&i.off(C,e.cropend),t.isFunction(e.crop)&&i.off(y,e.crop),t.isFunction(e.zoom)&&i.off("zoom",e.zoom),a.off(B,this.cropStart),e.zoomable&&e.zoomOnWheel&&a.off(D,this.wheel),e.toggleDragModeOnDblclick&&a.off("dblclick",this.dblclick),t(this.element.ownerDocument).off(k,this.onCropMove).off(W,this.onCropEnd),e.responsive&&t(window).off("resize",this.onResize)}},V={resize:function(){var i=this.options,e=this.$container,a=this.container,n=Number(i.minContainerWidth)||200,o=Number(i.minContainerHeight)||100;if(!(this.disabled||a.width<=n||a.height<=o)){var h=e.width()/a.width;if(1!==h||e.height()!==a.height){var s=void 0,r=void 0;i.restore&&(s=this.getCanvasData(),r=this.getCropBoxData()),this.render(),i.restore&&(this.setCanvasData(t.each(s,function(t,i){s[t]=i*h})),this.setCropBoxData(t.each(r,function(t,i){r[t]=i*h})))}}},dblclick:function(){this.disabled||"none"===this.options.dragMode||this.setDragMode(this.$dragBox.hasClass(m)?"move":"crop")},wheel:function(t){var i=this,e=t.originalEvent||t,a=Number(this.options.wheelZoomRatio)||.1;if(!this.disabled&&(t.preventDefault(),!this.wheeling)){this.wheeling=!0,setTimeout(function(){i.wheeling=!1},50);var n=1;e.deltaY?n=e.deltaY>0?1:-1:e.wheelDelta?n=-e.wheelDelta/120:e.detail&&(n=e.detail>0?1:-1),this.zoom(-n*a,t)}},cropStart:function(i){if(!this.disabled){var e=this.options,a=this.pointers,n=i.originalEvent,o=void 0;n&&n.changedTouches?t.each(n.changedTouches,function(t,i){a[i.identifier]=r(i)}):a[n&&n.pointerId||0]=r(n||i),o=L(a).length>1&&e.zoomable&&e.zoomOnTouch?"zoom":t(i.target).data(x),T.test(o)&&(this.trigger($,{originalEvent:n,action:o}).isDefaultPrevented()||(i.preventDefault(),this.action=o,this.cropping=!1,"crop"===o&&(this.cropping=!0,this.$dragBox.addClass(v))))}},cropMove:function(i){var e=this.action;if(!this.disabled&&e){var a=this.pointers,n=i.originalEvent;i.preventDefault(),this.trigger(M,{originalEvent:n,action:e}).isDefaultPrevented()||(n&&n.changedTouches?t.each(n.changedTouches,function(i,e){t.extend(a[e.identifier],r(e,!0))}):t.extend(a[n&&n.pointerId||0],r(n||i,!0)),this.change(i))}},cropEnd:function(i){if(!this.disabled){var e=this.action,a=this.pointers,n=i.originalEvent;n&&n.changedTouches?t.each(n.changedTouches,function(t,i){delete a[i.identifier]}):delete a[n&&n.pointerId||0],e&&(i.preventDefault(),L(a).length||(this.action=""),this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass(v,this.cropped&&this.options.modal)),this.trigger(C,{originalEvent:n,action:e}))}}},G={change:function(i){var e=this.options,a=this.pointers,n=this.container,o=this.canvas,h=this.cropBox,s=this.action,r=e.aspectRatio,d=h.left,l=h.top,c=h.width,p=h.height,m=d+c,g=l+p,f=0,v=0,w=n.width,x=n.height,b=!0,y=void 0;!r&&i.shiftKey&&(r=c&&p?c/p:1),this.limited&&(f=h.minLeft,v=h.minTop,w=f+Math.min(n.width,o.width,o.left+o.width),x=v+Math.min(n.height,o.height,o.top+o.height));var C,M,$,B=a[L(a)[0]],k={x:B.endX-B.startX,y:B.endY-B.startY},W=function(t){switch(t){case"e":m+k.x>w&&(k.x=w-m);break;case"w":d+k.x<f&&(k.x=f-d);break;case"n":l+k.y<v&&(k.y=v-l);break;case"s":g+k.y>x&&(k.y=x-g)}};switch(s){case"all":d+=k.x,l+=k.y;break;case"e":if(k.x>=0&&(m>=w||r&&(l<=v||g>=x))){b=!1;break}W("e"),c+=k.x,r&&(p=c/r,l-=k.x/r/2),c<0&&(s="w",c=0);break;case"n":if(k.y<=0&&(l<=v||r&&(d<=f||m>=w))){b=!1;break}W("n"),p-=k.y,l+=k.y,r&&(c=p*r,d+=k.y*r/2),p<0&&(s="s",p=0);break;case"w":if(k.x<=0&&(d<=f||r&&(l<=v||g>=x))){b=!1;break}W("w"),c-=k.x,d+=k.x,r&&(p=c/r,l+=k.x/r/2),c<0&&(s="e",c=0);break;case"s":if(k.y>=0&&(g>=x||r&&(d<=f||m>=w))){b=!1;break}W("s"),p+=k.y,r&&(c=p*r,d-=k.y*r/2),p<0&&(s="n",p=0);break;case"ne":if(r){if(k.y<=0&&(l<=v||m>=w)){b=!1;break}W("n"),p-=k.y,l+=k.y,c=p*r}else W("n"),W("e"),k.x>=0?m<w?c+=k.x:k.y<=0&&l<=v&&(b=!1):c+=k.x,k.y<=0?l>v&&(p-=k.y,l+=k.y):(p-=k.y,l+=k.y);c<0&&p<0?(s="sw",p=0,c=0):c<0?(s="nw",c=0):p<0&&(s="se",p=0);break;case"nw":if(r){if(k.y<=0&&(l<=v||d<=f)){b=!1;break}W("n"),p-=k.y,l+=k.y,c=p*r,d+=k.y*r}else W("n"),W("w"),k.x<=0?d>f?(c-=k.x,d+=k.x):k.y<=0&&l<=v&&(b=!1):(c-=k.x,d+=k.x),k.y<=0?l>v&&(p-=k.y,l+=k.y):(p-=k.y,l+=k.y);c<0&&p<0?(s="se",p=0,c=0):c<0?(s="ne",c=0):p<0&&(s="sw",p=0);break;case"sw":if(r){if(k.x<=0&&(d<=f||g>=x)){b=!1;break}W("w"),c-=k.x,d+=k.x,p=c/r}else W("s"),W("w"),k.x<=0?d>f?(c-=k.x,d+=k.x):k.y>=0&&g>=x&&(b=!1):(c-=k.x,d+=k.x),k.y>=0?g<x&&(p+=k.y):p+=k.y;c<0&&p<0?(s="ne",p=0,c=0):c<0?(s="se",c=0):p<0&&(s="nw",p=0);break;case"se":if(r){if(k.x>=0&&(m>=w||g>=x)){b=!1;break}W("e"),p=(c+=k.x)/r}else W("s"),W("e"),k.x>=0?m<w?c+=k.x:k.y>=0&&g>=x&&(b=!1):c+=k.x,k.y>=0?g<x&&(p+=k.y):p+=k.y;c<0&&p<0?(s="nw",p=0,c=0):c<0?(s="sw",c=0):p<0&&(s="ne",p=0);break;case"move":this.move(k.x,k.y),b=!1;break;case"zoom":this.zoom((C=a,M=t.extend({},C),$=[],t.each(C,function(i,e){delete M[i],t.each(M,function(t,i){var a=Math.abs(e.startX-i.startX),n=Math.abs(e.startY-i.startY),o=Math.abs(e.endX-i.endX),h=Math.abs(e.endY-i.endY),s=Math.sqrt(a*a+n*n),r=(Math.sqrt(o*o+h*h)-s)/s;$.push(r)})}),$.sort(function(t,i){return Math.abs(t)<Math.abs(i)}),$[0]),i.originalEvent),b=!1;break;case"crop":if(!k.x||!k.y){b=!1;break}y=this.$cropper.offset(),d=B.startX-y.left,l=B.startY-y.top,c=h.minWidth,p=h.minHeight,k.x>0?s=k.y>0?"se":"ne":k.x<0&&(d-=c,s=k.y>0?"sw":"nw"),k.y<0&&(l-=p),this.cropped||(this.$cropBox.removeClass(u),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0))}b&&(h.width=c,h.height=p,h.left=d,h.top=l,this.action=s,this.renderCropBox()),t.each(a,function(t,i){i.startX=i.endX,i.startY=i.endY})}},J={crop:function(){this.ready&&!this.disabled&&(this.cropped||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass(v),this.$cropBox.removeClass(u)),this.setCropBoxData(this.initialCropBox))},reset:function(){this.ready&&!this.disabled&&(this.image=t.extend({},this.initialImage),this.canvas=t.extend({},this.initialCanvas),this.cropBox=t.extend({},this.initialCropBox),this.renderCanvas(),this.cropped&&this.renderCropBox())},clear:function(){this.cropped&&!this.disabled&&(t.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),this.$dragBox.removeClass(v),this.$cropBox.addClass(u))},replace:function(t,i){!this.disabled&&t&&(this.isImg&&this.$element.attr("src",t),i?(this.url=t,this.$clone.attr("src",t),this.ready&&this.$preview.find("img").add(this.$clone2).attr("src",t)):(this.isImg&&(this.replaced=!0),this.options.data=null,this.load(t)))},enable:function(){this.ready&&(this.disabled=!1,this.$cropper.removeClass(g))},disable:function(){this.ready&&(this.disabled=!0,this.$cropper.addClass(g))},destroy:function(){var t=this.$element;this.loaded?(this.isImg&&this.replaced&&t.attr("src",this.originalUrl),this.unbuild(),t.removeClass(u)):this.isImg?t.off("load",this.start):this.$clone&&this.$clone.remove(),t.removeData(p)},move:function(t,i){var a=this.canvas,n=a.left,o=a.top;this.moveTo(e(t)?t:n+Number(t),e(i)?i:o+Number(i))},moveTo:function(t,a){var n=this.canvas,o=!1;e(a)&&(a=t),t=Number(t),a=Number(a),this.ready&&!this.disabled&&this.options.movable&&(i(t)&&(n.left=t,o=!0),i(a)&&(n.top=a,o=!0),o&&this.renderCanvas(!0))},zoom:function(t,i){var e=this.canvas;t=(t=Number(t))<0?1/(1-t):1+t,this.zoomTo(e.width*t/e.naturalWidth,i)},zoomTo:function(i,e){var a,n,o,h,s=this.options,r=this.pointers,d=this.canvas,l=d.width,c=d.height,p=d.naturalWidth,m=d.naturalHeight;if((i=Number(i))>=0&&this.ready&&!this.disabled&&s.zoomable){var g=p*i,u=m*i,f=void 0;if(e&&(f=e.originalEvent),this.trigger("zoom",{originalEvent:f,oldRatio:l/p,ratio:g/p}).isDefaultPrevented())return;if(f){var v=this.$cropper.offset(),w=r&&L(r).length?(a=r,n=0,o=0,h=0,t.each(a,function(t,i){var e=i.startX,a=i.startY;n+=e,o+=a,h+=1}),{pageX:n/=h,pageY:o/=h}):{pageX:e.pageX||f.pageX||0,pageY:e.pageY||f.pageY||0};d.left-=(g-l)*((w.pageX-v.left-d.left)/l),d.top-=(u-c)*((w.pageY-v.top-d.top)/c)}else d.left-=(g-l)/2,d.top-=(u-c)/2;d.width=g,d.height=u,this.renderCanvas(!0)}},rotate:function(t){this.rotateTo((this.image.rotate||0)+Number(t))},rotateTo:function(t){i(t=Number(t))&&this.ready&&!this.disabled&&this.options.rotatable&&(this.image.rotate=t%360,this.renderCanvas(!0,!0))},scaleX:function(t){var e=this.image.scaleY;this.scale(t,i(e)?e:1)},scaleY:function(t){var e=this.image.scaleX;this.scale(i(e)?e:1,t)},scale:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t,a=this.image,n=!1;t=Number(t),e=Number(e),this.ready&&!this.disabled&&this.options.scalable&&(i(t)&&(a.scaleX=t,n=!0),i(e)&&(a.scaleY=e,n=!0),n&&this.renderCanvas(!0,!0))},getData:function(){var i=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.options,a=this.image,n=this.canvas,o=this.cropBox,h=void 0;if(this.ready&&this.cropped){h={x:o.left-n.left,y:o.top-n.top,width:o.width,height:o.height};var s=a.width/a.naturalWidth;t.each(h,function(t,e){e/=s,h[t]=i?Math.round(e):e})}else h={x:0,y:0,width:0,height:0};return e.rotatable&&(h.rotate=a.rotate||0),e.scalable&&(h.scaleX=a.scaleX||1,h.scaleY=a.scaleY||1),h},setData:function(e){var a=this.options,n=this.image,o=this.canvas,h={};if(t.isFunction(e)&&(e=e.call(this.element)),this.ready&&!this.disabled&&t.isPlainObject(e)){var s=!1;a.rotatable&&i(e.rotate)&&e.rotate!==n.rotate&&(n.rotate=e.rotate,s=!0),a.scalable&&(i(e.scaleX)&&e.scaleX!==n.scaleX&&(n.scaleX=e.scaleX,s=!0),i(e.scaleY)&&e.scaleY!==n.scaleY&&(n.scaleY=e.scaleY,s=!0)),s&&this.renderCanvas(!0,!0);var r=n.width/n.naturalWidth;i(e.x)&&(h.left=e.x*r+o.left),i(e.y)&&(h.top=e.y*r+o.top),i(e.width)&&(h.width=e.width*r),i(e.height)&&(h.height=e.height*r),this.setCropBoxData(h)}},getContainerData:function(){return this.ready?t.extend({},this.container):{}},getImageData:function(){return this.loaded?t.extend({},this.image):{}},getCanvasData:function(){var i=this.canvas,e={};return this.ready&&t.each(["left","top","width","height","naturalWidth","naturalHeight"],function(t,a){e[a]=i[a]}),e},setCanvasData:function(e){var a=this.canvas,n=a.aspectRatio;t.isFunction(e)&&(e=e.call(this.$element)),this.ready&&!this.disabled&&t.isPlainObject(e)&&(i(e.left)&&(a.left=e.left),i(e.top)&&(a.top=e.top),i(e.width)?(a.width=e.width,a.height=e.width/n):i(e.height)&&(a.height=e.height,a.width=e.height*n),this.renderCanvas(!0))},getCropBoxData:function(){var t=this.cropBox;return this.ready&&this.cropped?{left:t.left,top:t.top,width:t.width,height:t.height}:{}},setCropBoxData:function(e){var a=this.cropBox,n=this.options.aspectRatio,o=void 0,h=void 0;t.isFunction(e)&&(e=e.call(this.$element)),this.ready&&this.cropped&&!this.disabled&&t.isPlainObject(e)&&(i(e.left)&&(a.left=e.left),i(e.top)&&(a.top=e.top),i(e.width)&&e.width!==a.width&&(o=!0,a.width=e.width),i(e.height)&&e.height!==a.height&&(h=!0,a.height=e.height),n&&(o?a.height=a.width/n:h&&(a.width=a.height*n)),this.renderCropBox())},getCroppedCanvas:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var e,a,o,h,s,r,l,c,p,m,g,u,f,v,w,x,b,y,C,M,$,B,k,W,D,T,H,Y,X,z,O,E,R,L,P,I,U=this.canvas,A=(e=this.$clone[0],a=this.image,o=U,h=i,s=a.naturalWidth,r=a.naturalHeight,l=a.rotate,c=void 0===l?0:l,p=a.scaleX,m=void 0===p?1:p,g=a.scaleY,u=void 0===g?1:g,f=o.aspectRatio,v=o.naturalWidth,w=o.naturalHeight,x=h.fillColor,b=void 0===x?"transparent":x,y=h.imageSmoothingEnabled,C=void 0===y||y,M=h.imageSmoothingQuality,$=void 0===M?"low":M,B=h.maxWidth,k=void 0===B?1/0:B,W=h.maxHeight,D=void 0===W?1/0:W,T=h.minWidth,H=void 0===T?0:T,Y=h.minHeight,X=void 0===Y?0:Y,z=d({aspectRatio:f,width:k,height:D}),O=d({aspectRatio:f,width:H,height:X}),E=Math.min(z.width,Math.max(O.width,v)),R=Math.min(z.height,Math.max(O.height,w)),L=document.createElement("canvas"),P=L.getContext("2d"),I=[-s/2,-r/2,s,r],L.width=n(E),L.height=n(R),P.fillStyle=b,P.fillRect(0,0,E,R),P.save(),P.translate(E/2,R/2),P.rotate(c*Math.PI/180),P.scale(m,u),P.imageSmoothingEnabled=!!C,P.imageSmoothingQuality=$,P.drawImage.apply(P,[e].concat(N(t.map(I,function(t){return Math.floor(n(t))})))),P.restore(),L);if(!this.cropped)return A;var F=this.getData(),j=F.x,S=F.y,q=F.width,Q=F.height,K=q/Q,Z=d({aspectRatio:K,width:i.maxWidth||1/0,height:i.maxHeight||1/0}),V=d({aspectRatio:K,width:i.minWidth||0,height:i.minHeight||0}),G=d({aspectRatio:K,width:i.width||q,height:i.height||Q}),J=G.width,_=G.height;J=Math.min(Z.width,Math.max(V.width,J)),_=Math.min(Z.height,Math.max(V.height,_));var tt=document.createElement("canvas"),it=tt.getContext("2d");tt.width=n(J),tt.height=n(_),it.fillStyle=i.fillColor||"transparent",it.fillRect(0,0,J,_);var et=i.imageSmoothingEnabled,at=void 0===et||et,nt=i.imageSmoothingQuality;it.imageSmoothingEnabled=at,nt&&(it.imageSmoothingQuality=nt);var ot=A.width,ht=A.height,st=j,rt=S,dt=void 0,lt=void 0,ct=void 0,pt=void 0,mt=void 0,gt=void 0;st<=-q||st>ot?(st=0,dt=0,ct=0,mt=0):st<=0?(ct=-st,st=0,mt=dt=Math.min(ot,q+st)):st<=ot&&(ct=0,mt=dt=Math.min(q,ot-st)),dt<=0||rt<=-Q||rt>ht?(rt=0,lt=0,pt=0,gt=0):rt<=0?(pt=-rt,rt=0,gt=lt=Math.min(ht,Q+rt)):rt<=ht&&(pt=0,gt=lt=Math.min(Q,ht-rt));var ut=[st,rt,dt,lt];if(mt>0&&gt>0){var ft=J/q;ut.push(ct*ft,pt*ft,mt*ft,gt*ft)}return it.drawImage.apply(it,[A].concat(N(t.map(ut,function(t){return Math.floor(n(t))})))),tt},setAspectRatio:function(t){var i=this.options;this.disabled||e(t)||(i.aspectRatio=Math.max(0,t)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox()))},setDragMode:function(t){var i=this.options,e=void 0,a=void 0;this.loaded&&!this.disabled&&(e="crop"===t,a=i.movable&&"move"===t,t=e||a?t:"none",this.$dragBox.data(x,t).toggleClass(m,e).toggleClass(w,a),i.cropBoxMovable||this.$face.data(x,t).toggleClass(m,e).toggleClass(w,a))}},_=function(){function i(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(O(this,i),!e||!X.test(e.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=e,this.$element=t(e),this.options=t.extend({},z,t.isPlainObject(a)&&a),this.completed=!1,this.cropped=!1,this.disabled=!1,this.isImg=!1,this.limited=!1,this.loaded=!1,this.ready=!1,this.replaced=!1,this.wheeling=!1,this.originalUrl="",this.canvas=null,this.cropBox=null,this.pointers={},this.init()}return E(i,[{key:"init",value:function(){var t=this.$element,i=void 0;if(t.is("img")){if(this.isImg=!0,i=t.attr("src")||"",this.originalUrl=i,!i)return;i=t.prop("src")}else t.is("canvas")&&window.HTMLCanvasElement&&(i=t[0].toDataURL());this.load(i)}},{key:"trigger",value:function(i,e){var a=t.Event(i,e);return this.$element.trigger(a),a}},{key:"load",value:function(i){var e=this;if(i){this.url=i,this.image={};var a=this.$element,n=this.options;if(n.checkOrientation&&window.ArrayBuffer)if(H.test(i))Y.test(i)?this.read((s=i.replace(q,""),r=atob(s),d=new ArrayBuffer(r.length),l=new Uint8Array(d),t.each(l,function(t){l[t]=r.charCodeAt(t)}),d)):this.clone();else{var s,r,d,l,c=new XMLHttpRequest;c.onerror=function(){e.clone()},c.onload=function(){e.read(c.response)},n.checkCrossOrigin&&o(i)&&!a.prop("crossOrigin")&&(i=h(i)),c.open("get",i),c.responseType="arraybuffer",c.withCredentials="use-credentials"===a.prop("crossOrigin"),c.send()}else this.clone()}}},{key:"read",value:function(i){var e,a,n,o=this.options,h=this.image,s=l(i),r=0,d=1,c=1;if(s>1){this.url=(e="image/jpeg",a=new Uint8Array(i),n="",t.each(a,function(t,i){n+=S(i)}),"data:"+e+";base64,"+btoa(n));var p=function(t){var i=0,e=1,a=1;switch(t){case 2:e=-1;break;case 3:i=-180;break;case 4:a=-1;break;case 5:i=90,a=-1;break;case 6:i=90;break;case 7:i=90,e=-1;break;case 8:i=-90}return{rotate:i,scaleX:e,scaleY:a}}(s);r=p.rotate,d=p.scaleX,c=p.scaleY}o.rotatable&&(h.rotate=r),o.scalable&&(h.scaleX=d,h.scaleY=c),this.clone()}},{key:"clone",value:function(){var i=this.$element,e=this.options,a=this.url,n="",s=void 0;e.checkCrossOrigin&&o(a)&&((n=i.prop("crossOrigin"))?s=a:(n="anonymous",s=h(a))),this.crossOrigin=n,this.crossOriginUrl=s;var r=document.createElement("img");n&&(r.crossOrigin=n),r.src=s||a;var d=t(r);this.$clone=d,this.isImg?this.element.complete?this.start():i.one("load",t.proxy(this.start,this)):d.one("load",t.proxy(this.start,this)).one("error",t.proxy(this.stop,this)).addClass(f).insertAfter(i)}},{key:"start",value:function(){var i=this,e=this.$clone,a=this.$element;this.isImg||(e.off("error",this.stop),a=e),function(t,i){if(!t.naturalWidth||F){var e=document.createElement("img");e.onload=function(){i(e.width,e.height)},e.src=t.src}else i(t.naturalWidth,t.naturalHeight)}(a[0],function(e,a){t.extend(i.image,{naturalWidth:e,naturalHeight:a,aspectRatio:e/a}),i.loaded=!0,i.build()})}},{key:"stop",value:function(){this.$clone.remove(),this.$clone=null}},{key:"build",value:function(){var i=this;if(this.loaded){this.ready&&this.unbuild();var e=this.$element,a=this.options,n=this.$clone,o=t('<div class="cropper-container"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>'),h=o.find("."+p+"-crop-box"),s=h.find("."+p+"-face");this.$container=e.parent(),this.$cropper=o,this.$canvas=o.find("."+p+"-canvas").append(n),this.$dragBox=o.find("."+p+"-drag-box"),this.$cropBox=h,this.$viewBox=o.find("."+p+"-view-box"),this.$face=s,e.addClass(u).after(o),this.isImg||n.removeClass(f),this.initPreview(),this.bind(),a.aspectRatio=Math.max(0,a.aspectRatio)||NaN,a.viewMode=Math.max(0,Math.min(3,Math.round(a.viewMode)))||0,this.cropped=a.autoCrop,a.autoCrop?a.modal&&this.$dragBox.addClass(v):h.addClass(u),a.guides||h.find("."+p+"-dashed").addClass(u),a.center||h.find("."+p+"-center").addClass(u),a.cropBoxMovable&&s.addClass(w).data(x,"all"),a.highlight||s.addClass("cropper-invisible"),a.background&&o.addClass(p+"-bg"),a.cropBoxResizable||h.find("."+p+"-line,."+p+"-point").addClass(u),this.setDragMode(a.dragMode),this.render(),this.ready=!0,this.setData(a.data),this.completing=setTimeout(function(){t.isFunction(a.ready)&&e.one("ready",a.ready),i.trigger("ready"),i.trigger(y,i.getData()),i.completed=!0},0)}}},{key:"unbuild",value:function(){this.ready&&(this.completed||clearTimeout(this.completing),this.ready=!1,this.completed=!1,this.initialImage=null,this.initialCanvas=null,this.initialCropBox=null,this.container=null,this.canvas=null,this.cropBox=null,this.unbind(),this.resetPreview(),this.$preview=null,this.$viewBox=null,this.$cropBox=null,this.$dragBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)}}],[{key:"setDefaults",value:function(i){t.extend(z,t.isPlainObject(i)&&i)}}]),i}();if(t.extend&&t.extend(_.prototype,Q,K,Z,V,G,J),t.fn){var tt=t.fn.cropper;t.fn.cropper=function(i){for(var a=arguments.length,n=Array(a>1?a-1:0),o=1;o<a;o++)n[o-1]=arguments[o];var h=void 0;return this.each(function(e,a){var o=t(a),s=o.data(p);if(!s){if(/destroy/.test(i))return;var r=t.extend({},o.data(),t.isPlainObject(i)&&i);s=new _(a,r),o.data(p,s)}if("string"==typeof i){var d=s[i];t.isFunction(d)&&(h=d.apply(s,n))}}),e(h)?this:h},t.fn.cropper.Constructor=_,t.fn.cropper.setDefaults=_.setDefaults,t.fn.cropper.noConflict=function(){return t.fn.cropper=tt,this}}});